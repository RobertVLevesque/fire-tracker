<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Fire Tracker</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    #controls {
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      z-index: 1;
      padding: 10px;
      font-family: sans-serif;
      font-size: 14px;
      border-radius: 4px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
<div id="map"></div>
<div id="controls">
  <label>Map Style:
    <select id="style-switcher">
      <option value="mapbox://styles/mapbox/satellite-streets-v12">Satellite + Streets</option>
      <option value="mapbox://styles/mapbox/light-v10">Light</option>
      <option value="mapbox://styles/mapbox/dark-v11">Dark</option>
      <option value="mapbox://styles/mapbox/outdoors-v11">Outdoors</option>
      <option value="mapbox://styles/mapbox/streets-v12">Streets</option>
    </select>
  </label><br/>
  <label><input type="checkbox" id="toggle-cwfis" checked /> CWFIS Fire Zones</label><br/>
  <label><input type="checkbox" id="toggle-perimeters" checked /> CWFIS Perimeters</label>
</div>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script>
mapboxgl.accessToken = 'pk.eyJ1Ijoicm9iZXJ0dmxldmVzcXVlIiwiYSI6ImNtYmYwMjg4ZjIyd3UyaXBvand4c21mYXcifQ.XiHliWAicUYAIZ17JQdRng';

const fireDataURL = 'https://raw.githubusercontent.com/RobertVLevesque/fire-tracker/main/data/fire_alerts.geojson';
const iconURL = 'https://upload.wikimedia.org/wikipedia/commons/5/5f/FireIcon.svg';

let map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/satellite-streets-v12',
  center: [-95, 56],
  zoom: 4
});

document.getElementById('style-switcher').addEventListener('change', function () {
  map.setStyle(this.value);
});

function addCustomLayers() {
  // Fires GeoJSON
  map.addSource('fires', {
    type: 'geojson',
    data: fireDataURL
  });

  map.addLayer({
    id: 'fire-icons',
    type: 'symbol',
    source: 'fires',
    layout: {
      'icon-image': 'fire-icon',
      'icon-size': 0.05,
      'icon-allow-overlap': true
    }
  });

  // CWFIS Fire Zones (Raster)
  map.addSource('cwfis-zones', {
    type: 'raster',
    tiles: ['https://cwfis.cfs.nrcan.gc.ca/arcgis/services/public/cwfis/en/MapServer/WmsServer?SERVICE=WMS&REQUEST=GetMap&VERSION=1.1.1&LAYERS=0&STYLES=&FORMAT=image/png&TRANSPARENT=true&SRS=EPSG:3857&BBOX={bbox-epsg-3857}&WIDTH=256&HEIGHT=256'],
    tileSize: 256
  });

  map.addLayer({
    id: 'cwfis-zones-layer',
    type: 'raster',
    source: 'cwfis-zones',
    paint: { 'raster-opacity': 0.5 }
  });

  // CWFIS Perimeters (WMS Layer 1)
  map.addSource('cwfis-perimeters', {
    type: 'raster',
    tiles: ['https://cwfis.cfs.nrcan.gc.ca/arcgis/services/public/cwfis/en/MapServer/WmsServer?SERVICE=WMS&REQUEST=GetMap&VERSION=1.1.1&LAYERS=1&STYLES=&FORMAT=image/png&TRANSPARENT=true&SRS=EPSG:3857&BBOX={bbox-epsg-3857}&WIDTH=256&HEIGHT=256'],
    tileSize: 256
  });

  map.addLayer({
    id: 'cwfis-perimeters-layer',
    type: 'raster',
    source: 'cwfis-perimeters',
    paint: { 'raster-opacity': 0.7 }
  });
}

function toggleLayer(layerId, visible) {
  if (map.getLayer(layerId)) {
    map.setLayoutProperty(layerId, 'visibility', visible ? 'visible' : 'none');
  }
}

map.on('style.load', () => {
  map.loadImage(iconURL, (error, image) => {
    if (error) throw error;
    if (!map.hasImage('fire-icon')) map.addImage('fire-icon', image);
    addCustomLayers();
  });
});

document.getElementById('toggle-cwfis').addEventListener('change', (e) => {
  toggleLayer('cwfis-zones-layer', e.target.checked);
});
document.getElementById('toggle-perimeters').addEventListener('change', (e) => {
  toggleLayer('cwfis-perimeters-layer', e.target.checked);
});
</script>
</body>
</html>
