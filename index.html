<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Fire Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    #filters {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      z-index: 1;
      font-family: sans-serif;
    }
    #filters label {
      display: block;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

<div id="filters">
  <label><input type="radio" name="status" value="all" checked /> Show All</label>
  <label><input type="radio" name="status" value="Out of Control" /> Out of Control</label>
  <label><input type="radio" name="status" value="Being Held" /> Being Held</label>
  <label><input type="radio" name="status" value="Under Control" /> Under Control</label>
</div>

<div id="map"></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoicm9iZXJ0dmxldmVzcXVlIiwiYSI6ImNtYmYwMjg4ZjIyd3UyaXBvand4c21mYXcifQ.XiHliWAicUYAIZ17JQdRng';

  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/satellite-streets-v12',
    center: [-105, 55],
    zoom: 4,
    projection: 'globe'
  });

  map.on('load', () => {
    // Add perimeter source
    map.addSource('perimeters', {
      type: 'geojson',
      data: 'https://cwfis.cfs.nrcan.gc.ca/data/geojson/perimeter_active.json'
    });

    // Add filled layer
    map.addLayer({
      id: 'perimeter-fill',
      type: 'fill',
      source: 'perimeters',
      paint: {
        'fill-color': [
          'match',
          ['get', 'status'],
          'Out of Control', '#e60000',
          'Being Held', '#ff9900',
          'Under Control', '#33cc33',
          '#999999'
        ],
        'fill-opacity': 0.3
      }
    });

    // Add outline layer
    map.addLayer({
      id: 'perimeter-outline',
      type: 'line',
      source: 'perimeters',
      paint: {
        'line-color': '#000000',
        'line-width': 1
      }
    });

    // Filter control
    document.querySelectorAll('input[name="status"]').forEach((el) => {
      el.addEventListener('change', (e) => {
        const val = e.target.value;
        if (val === 'all') {
          map.setFilter('perimeter-fill', null);
          map.setFilter('perimeter-outline', null);
        } else {
          map.setFilter('perimeter-fill', ['==', ['get', 'status'], val]);
          map.setFilter('perimeter-outline', ['==', ['get', 'status'], val]);
        }
      });
    });
  });
</script>

</body>
</html>

    });
  </script>
</body>
</html>
