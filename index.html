<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Fire Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; font-family: sans-serif; }
    #map { position: absolute; top: 50px; bottom: 0; width: 100%; }

    .filters {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 1;
    }

    .filters button {
      padding: 8px 14px;
      margin-right: 5px;
      border: none;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s;
    }

    .filters button.active {
      transform: scale(1.1);
    }

    .red { background-color: #f44336; color: white; }
    .yellow { background-color: #ffc107; color: black; }
    .green { background-color: #4caf50; color: white; }

    .popup {
      background-color: #0b3a6a;
      color: #fff;
      padding: 12px;
      border-radius: 8px;
      max-width: 240px;
      font-family: 'Segoe UI', sans-serif;
    }

    .popup h3 {
      margin: 0 0 8px;
      font-size: 18px;
      color: white;
    }

    .popup p {
      margin: 2px 0;
      font-size: 14px;
    }

    .popup p span {
      color: #4dd0e1;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="filters">
<button class=data-status="OC">Out of Control</button>
<button class=data-status="BH">Being Held</button>
<button class=data-status="UC">Under Control</button>
  </div>
  <div id="map"></div>

  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoicm9iZXJ0dmxldmVzcXVlIiwiYSI6ImNtYmYwMjg4ZjIyd3UyaXBvand4c21mYXcifQ.XiHliWAicUYAIZ17JQdRng';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/satellite-streets-v12',
      center: [-100, 55],
      zoom: 4
    });

    let allFires = [];

    async function loadData() {
      const res = await fetch('./data/fire_alerts.geojson');
      const geojson = await res.json();
      allFires = geojson.features;
      drawFires(allFires);
    }

    function drawFires(features) {
      const colors = { OC: '#f44336', BH: '#ffc107', UC: '#4caf50' };

      map.on('load', () => {
        features.forEach((feature, i) => {
          const { name, size = 0, status, agency, updated } = feature.properties;
          const [lon, lat] = feature.geometry.coordinates;

const popupHtml = `
  <div style="padding:10px; background:#003f63; color:white; font-family:sans-serif; border-radius:8px;">
    <h3 style="margin:0 0 5px; font-size:1.2em;">${fireName}</h3>
    <div style="color:#00bfff;">Size: ${size} ha</div>
    <div style="color:#00bfff;">Start Date: ${updated}</div>
    <div style="color:#00bfff;">Agency: ${agency}</div>
  </div>`;


          new mapboxgl.CircleMarker({
            center: [lon, lat],
            color: colors[status] || '#ccc',
            radius: Math.max(Math.sqrt(size) * 0.3, 4),
            popup: new mapboxgl.Popup({ offset: 25 }).setHTML(popupHtml)
          }).addTo(map);
        });
      });
    }

   function filterFires(statusCode) {
  document.querySelectorAll('.filters button').forEach(btn => {
    btn.classList.remove('active');
    if (btn.dataset.status === statusCode) {
      btn.classList.add('active');
    }
  });

  map.eachLayer(layer => {
    if (layer.id.startsWith('circle-')) {
      map.removeLayer(layer.id);
    }
  });

  const filtered = allFires.filter(f => f.properties.status === statusCode);
  drawFires(filtered);
}


    loadData();
  </script>
</body>
</html>
