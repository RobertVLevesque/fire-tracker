<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Live Fire Tracker</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 0; font-family: sans-serif; }
    #map { position: absolute; top: 40px; bottom: 0; width: 100%; }
    #filters {
      position: absolute;
      top: 0; left: 0;
      background: rgba(255,255,255,0.95);
      padding: 8px;
      z-index: 1;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      width: 100%;
    }
    #filters label { font-size: 13px; }
    #filters select, #filters input {
      font-size: 13px;
      padding: 2px 6px;
    }
  </style>
</head>
<body>
  <div id="filters">
    <label>Status:
      <select id="status-filter">
        <option value="All">All</option>
        <option value="Out of Control">Out of Control</option>
        <option value="Being Held">Being Held</option>
        <option value="Under Control">Under Control</option>
        <option value="Prescribed">Prescribed</option>
        <option value="100% contained">100% contained</option>
      </select>
    </label>
    <label>Agency:
      <input type="text" id="agency-filter" placeholder="e.g. AB, BC" />
    </label>
    <label>Min Size (ha):
      <input type="number" id="min-size" value="0" />
    </label>
    <label>Max Size (ha):
      <input type="number" id="max-size" value="999999" />
    </label>
  </div>

  <div id="map"></div>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoicm9iZXJ0dmxldmVzcXVlIiwiYSI6ImNtYmYwMjg4ZjIyd3UyaXBvand4c21mYXcifQ.XiHliWAicUYAIZ17JQdRng';
    
    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/satellite-streets-v12',
      center: [-106.3, 56.1],
      zoom: 4
    });
<script>
let fireData = [];
let map;
let markers = [];

async function loadData() {
  try {
    const res = await fetch('data/fire_alerts.geojson');
    const geojson = await res.json();
    fireData = geojson.features;
    initMap();
    applyFilters();
  } catch (err) {
    console.error("ðŸ”¥ Error loading GeoJSON:", err);
    alert("Failed to load fire data.");
  }
}

function initMap() {
  mapboxgl.accessToken = 'YOUR_MAPBOX_TOKEN';
  map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/satellite-streets-v12',
    center: [-100, 55],
    zoom: 4
  });
}

function applyFilters() {
  // Clear existing markers
  markers.forEach(m => m.remove());
  markers = [];

  const status = document.getElementById('status').value;
  const agency = document.getElementById('agency').value.trim().toLowerCase();
  const minSize = parseFloat(document.getElementById('minSize').value) || 0;
  const maxSize = parseFloat(document.getElementById('maxSize').value) || 999999;

  fireData.forEach(feature => {
    const { coordinates } = feature.geometry;
    const props = feature.properties;

    if (
      (status === 'All' || props.status?.toLowerCase() === status.toLowerCase()) &&
      (agency === '' || props.agency?.toLowerCase() === agency) &&
      props.size >= minSize &&
      props.size <= maxSize
    ) {
      const sizeFactor = Math.sqrt(props.size) / 5; // scale icon size
      const el = document.createElement('div');
      el.className = 'fire-icon';
      el.style.width = `${sizeFactor + 10}px`;
      el.style.height = `${sizeFactor + 10}px`;
      el.style.background = 'red';
      el.style.borderRadius = '50%';
      el.style.border = '2px solid white';

      const marker = new mapboxgl.Marker(el)
        .setLngLat(coordinates)
        .setPopup(new mapboxgl.Popup().setHTML(`
          <strong>${props.name || 'Unknown Fire'}</strong><br/>
          Status: ${props.status || 'N/A'}<br/>
          Size: ${props.size?.toLocaleString()} ha<br/>
          Agency: ${props.agency || 'N/A'}<br/>
          Updated: ${props.updated || 'N/A'}<br/>
          Source: ${props.source || 'CWFIS'}<br/>
        `))
        .addTo(map);

      markers.push(marker);
    }
  });
}

window.onload = loadData;
</script>
   
